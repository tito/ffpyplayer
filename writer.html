<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>writer &mdash; FFPyPlayer 3.1-dev documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.1-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="FFPyPlayer 3.1-dev documentation" href="index.html" />
    <link rel="up" title="The FFPyPlayer API" href="api.html" />
    <link rel="prev" title="FFmpeg tools" href="tools.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="index.html"><img src="_static/logo.png" border="0" alt="py4sci"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tools.html" title="FFmpeg tools"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>

          <li><a href="api.html" accesskey="U">The FFPyPlayer API</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">writer</a><ul>
<li><a class="reference internal" href="#module-ffpyplayer.writer"><tt class="docutils literal"><span class="pre">ffpyplayer.writer</span></tt></a><ul>
<li><a class="reference internal" href="#ffmpeg-based-media-writer">FFmpeg based media writer</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tools.html"
                        title="previous chapter">FFmpeg tools</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/writer.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="writer">
<span id="writer-api"></span><h1>writer<a class="headerlink" href="#writer" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-ffpyplayer.writer">
<span id="ffpyplayer-writer"></span><h2><a class="reference internal" href="#module-ffpyplayer.writer" title="ffpyplayer.writer"><tt class="xref py py-mod docutils literal"><span class="pre">ffpyplayer.writer</span></tt></a><a class="headerlink" href="#module-ffpyplayer.writer" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ffmpeg-based-media-writer">
<h3>FFmpeg based media writer<a class="headerlink" href="#ffmpeg-based-media-writer" title="Permalink to this headline">¶</a></h3>
<p>A FFmpeg based python media writer. See <a class="reference internal" href="#ffpyplayer.writer.MediaWriter" title="ffpyplayer.writer.MediaWriter"><tt class="xref py py-class docutils literal"><span class="pre">MediaWriter</span></tt></a> for details.
Currently writes only video.</p>
<dl class="class">
<dt id="ffpyplayer.writer.MediaWriter">
<em class="property">class </em><tt class="descclassname">ffpyplayer.writer.</tt><tt class="descname">MediaWriter</tt><a class="headerlink" href="#ffpyplayer.writer.MediaWriter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<p>MediaWriter(filename, streams, fmt=&#8217;&#8216;, lib_opts={}, metadata={}, loglevel=&#8217;error&#8217;, overwrite=False, <a href="#id1"><span class="problematic" id="id2">**</span></a>kwargs)</p>
<p>An FFmpeg based media writer class. Currently only supports video.</p>
<p>With this class one can write images frames stored in many different pixel
formats into a multi-stream video file using <a class="reference internal" href="#ffpyplayer.writer.MediaWriter.write_frame" title="ffpyplayer.writer.MediaWriter.write_frame"><tt class="xref py py-meth docutils literal"><span class="pre">write_frame()</span></tt></a>. Many
video file and codec formats are supported.</p>
<dl class="docutils">
<dt><strong>Args</strong>:</dt>
<dd><p class="first"><em>filename</em> (str): The filename of the media file to create.</p>
<p><em>streams</em> (list): A list of streams to create in the file. <em>streams</em>
is a list of dicts, where each dict describes a corresponding stream.
Each dict configures the stream. The keywords listed below are
available. One can also specify default values for the keywords for
all streams using <em>kwargs</em>. Keywords also found in <em>streams</em> will
overwrite those in <em>kwargs</em>:</p>
<blockquote>
<div><p><em>pix_fmt_in</em> (str): The pixel format of the <a class="reference internal" href="pic.html#ffpyplayer.pic.Image" title="ffpyplayer.pic.Image"><tt class="xref py py-class docutils literal"><span class="pre">ffpyplayer.pic.Image</span></tt></a>
to be passed to <a class="reference internal" href="#ffpyplayer.writer.MediaWriter.write_frame" title="ffpyplayer.writer.MediaWriter.write_frame"><tt class="xref py py-meth docutils literal"><span class="pre">write_frame()</span></tt></a> for this stream. Can be one of
<a class="reference internal" href="tools.html#ffpyplayer.tools.pix_fmts" title="ffpyplayer.tools.pix_fmts"><tt class="xref py py-attr docutils literal"><span class="pre">ffpyplayer.tools.pix_fmts</span></tt></a>.</p>
<p><em>pix_fmt_out</em> (str): The pixel format in which frames will be
written to the file for this stream. Can be one of
<a class="reference internal" href="tools.html#ffpyplayer.tools.pix_fmts" title="ffpyplayer.tools.pix_fmts"><tt class="xref py py-attr docutils literal"><span class="pre">ffpyplayer.tools.pix_fmts</span></tt></a>. Defaults to <em>pix_fmt_in</em>
if not provided. Not every pixel format is supported for each
encoding codec, see <a class="reference internal" href="tools.html#ffpyplayer.tools.get_supported_pixfmts" title="ffpyplayer.tools.get_supported_pixfmts"><tt class="xref py py-func docutils literal"><span class="pre">ffpyplayer.tools.get_supported_pixfmts()</span></tt></a>
for which pixel formats are supported for <em>codec</em>.</p>
<p><em>width_in, height_in</em> (int): The width and height of the
<a class="reference internal" href="pic.html#ffpyplayer.pic.Image" title="ffpyplayer.pic.Image"><tt class="xref py py-class docutils literal"><span class="pre">ffpyplayer.pic.Image</span></tt></a> that will be passed to
<a class="reference internal" href="#ffpyplayer.writer.MediaWriter.write_frame" title="ffpyplayer.writer.MediaWriter.write_frame"><tt class="xref py py-meth docutils literal"><span class="pre">write_frame()</span></tt></a> for this stream.</p>
<p><em>width_out, height_out</em> (int): The width and height in which frames
will be written to the file for this stream. Defaults to
<em>width_in, height_in</em>, respectively, if not provided.</p>
<p><em>codec</em> (str): The codec used to write the frames to the file.
Can be one of the encoding codecs in
<a class="reference internal" href="tools.html#ffpyplayer.tools.codecs_enc" title="ffpyplayer.tools.codecs_enc"><tt class="xref py py-attr docutils literal"><span class="pre">ffpyplayer.tools.codecs_enc</span></tt></a>.</p>
<p><em>frame_rate</em> (2-tuple): A 2-tuple of ints representing the
frame rate used when writing the file. The first element is the
numerator, while the second is the denuminator of a ration
describing the rate. E.g. (2997, 100) describes 29.97 fps.
The timestamps of the frames written using <a class="reference internal" href="#ffpyplayer.writer.MediaWriter.write_frame" title="ffpyplayer.writer.MediaWriter.write_frame"><tt class="xref py py-meth docutils literal"><span class="pre">write_frame()</span></tt></a> do
not necessarily need to match the frame rate, or they might be
forced to matching timestamps if required. Not every frame rate is
supported for each encoding codec, see
<a class="reference internal" href="tools.html#ffpyplayer.tools.get_supported_framerates" title="ffpyplayer.tools.get_supported_framerates"><tt class="xref py py-func docutils literal"><span class="pre">ffpyplayer.tools.get_supported_framerates()</span></tt></a> for which frame
rates are supported for <em>codec</em>.</p>
</div></blockquote>
<p><em>fmt</em> (str): The format to use for the output. Can be one of
<a class="reference internal" href="tools.html#ffpyplayer.tools.formats_out" title="ffpyplayer.tools.formats_out"><tt class="xref py py-attr docutils literal"><span class="pre">ffpyplayer.tools.formats_out</span></tt></a>. Defaults to empty string.
If not provided, <em>filename</em> will be used determine the format,
otherwise this arg will be used.</p>
<p><em>lib_opts</em> (dict or list): A dictionary of options that will be passed
to the ffmpeg libraries, codecs, sws, and formats when opening them.
This accepts most of the options that can be passed to ffmpeg libraries.
See below for examples. Both the keywords and values must be strings.
It can be passed a dict in which case it&#8217;ll be applied to all the streams
or a list containing a dict for each stream.</p>
<p><em>metadata</em> (dict): Metadata that will be written to the streams, if
supported by the stream. See below for examples. Both the keywords and
values must be strings. It can be passed a dict in which case it&#8217;ll be
applied to all the streams or a list containing a dict for each stream.
If (these) metadata is not supported, it will silently fail to write them.</p>
<p><em>loglevel</em> (str): The level of logs to emit. Its value is one of the keywords
defined in <a class="reference internal" href="tools.html#ffpyplayer.tools.loglevels" title="ffpyplayer.tools.loglevels"><tt class="xref py py-attr docutils literal"><span class="pre">ffpyplayer.tools.loglevels</span></tt></a>. Note this only affects
the default FFmpeg logger, which prints to stderr. You can manipulate the
log stream directly using <a class="reference internal" href="tools.html#ffpyplayer.tools.set_log_callback" title="ffpyplayer.tools.set_log_callback"><tt class="xref py py-attr docutils literal"><span class="pre">ffpyplayer.tools.set_log_callback</span></tt></a>.</p>
<p><em>overwrite</em> (bool): Whether we should overwrite an existing file.
If False, an error will be raised if the file already exists. If True,
the file will be overwritten if it exists.</p>
<p class="last"><em>**kwargs</em>: Accepts default values for <em>streams</em> which will be used
if these keywords are not provided.</p>
</dd>
</dl>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ffpyplayer.writer</span> <span class="kn">import</span> <span class="n">MediaWriter</span>
<span class="kn">from</span> <span class="nn">ffpyplayer.pic</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span>
<span class="c"># write at 5 fps.</span>
<span class="n">out_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;pix_fmt_in&#39;</span><span class="p">:</span><span class="s">&#39;rgb24&#39;</span><span class="p">,</span> <span class="s">&#39;width_in&#39;</span><span class="p">:</span><span class="n">w</span><span class="p">,</span> <span class="s">&#39;height_in&#39;</span><span class="p">:</span><span class="n">h</span><span class="p">,</span> <span class="s">&#39;codec&#39;</span><span class="p">:</span><span class="s">&#39;rawvideo&#39;</span><span class="p">,</span>
            <span class="s">&#39;frame_rate&#39;</span><span class="p">:(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>
<span class="c"># write using rgb24 frames into a two stream rawvideo file where the output</span>
<span class="c"># is half the input size for both streams. Avi format will be used.</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">MediaWriter</span><span class="p">(</span><span class="s">&#39;output.avi&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">out_opts</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_out</span><span class="o">=</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                     <span class="n">height_out</span><span class="o">=</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="c"># Construct images</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">buf</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">255</span> <span class="o">/</span> <span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
<span class="n">buf</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span> <span class="n">buf</span><span class="p">))</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">plane_buffers</span><span class="o">=</span><span class="p">[</span><span class="n">buf</span><span class="p">],</span> <span class="n">pix_fmt</span><span class="o">=</span><span class="s">&#39;rgb24&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

<span class="n">buf</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">size</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span> <span class="o">/</span> <span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
<span class="n">buf</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span> <span class="n">buf</span><span class="p">))</span>
<span class="n">img2</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">plane_buffers</span><span class="o">=</span><span class="p">[</span><span class="n">buf</span><span class="p">],</span> <span class="n">pix_fmt</span><span class="o">=</span><span class="s">&#39;rgb24&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">write_frame</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="n">i</span> <span class="o">/</span> <span class="mf">5.</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c"># stream 1</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">write_frame</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">img2</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="n">i</span> <span class="o">/</span> <span class="mf">5.</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># stream 2</span>
</pre></div>
</div>
<p>Or force an output format of avi, even though the filename is .mp4.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">writer</span> <span class="o">=</span> <span class="n">MediaWriter</span><span class="p">(</span><span class="s">&#39;output.mp4&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">out_opts</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;avi&#39;</span><span class="p">,</span>
             <span class="n">width_out</span><span class="o">=</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height_out</span><span class="o">=</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Or writing compressed h264 files (notice the file is now only 5KB, while
the above results in a 10MB file):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ffpyplayer.writer</span> <span class="kn">import</span> <span class="n">MediaWriter</span>
<span class="kn">from</span> <span class="nn">ffpyplayer.tools</span> <span class="kn">import</span> <span class="n">get_supported_pixfmts</span><span class="p">,</span> <span class="n">get_supported_framerates</span>
<span class="kn">from</span> <span class="nn">ffpyplayer.pic</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="c"># make sure the pixel format and rate are supported.</span>
<span class="k">print</span> <span class="n">get_supported_pixfmts</span><span class="p">(</span><span class="s">&#39;libx264&#39;</span><span class="p">,</span> <span class="s">&#39;rgb24&#39;</span><span class="p">)</span>
<span class="p">[</span><span class="s">&#39;yuv420p&#39;</span><span class="p">,</span> <span class="s">&#39;yuvj420p&#39;</span><span class="p">,</span> <span class="s">&#39;yuv422p&#39;</span><span class="p">,</span> <span class="s">&#39;yuvj422p&#39;</span><span class="p">,</span> <span class="s">&#39;yuv444p&#39;</span><span class="p">,</span> <span class="s">&#39;yuvj444p&#39;</span><span class="p">,</span> <span class="s">&#39;nv12&#39;</span><span class="p">,</span> <span class="s">&#39;nv16&#39;</span><span class="p">]</span>
<span class="k">print</span> <span class="n">get_supported_framerates</span><span class="p">(</span><span class="s">&#39;libx264&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">[]</span>
<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span>
<span class="n">out_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;pix_fmt_in&#39;</span><span class="p">:</span><span class="s">&#39;rgb24&#39;</span><span class="p">,</span> <span class="s">&#39;width_in&#39;</span><span class="p">:</span><span class="n">w</span><span class="p">,</span> <span class="s">&#39;height_in&#39;</span><span class="p">:</span><span class="n">h</span><span class="p">,</span> <span class="s">&#39;codec&#39;</span><span class="p">:</span><span class="s">&#39;libx264&#39;</span><span class="p">,</span>
            <span class="s">&#39;frame_rate&#39;</span><span class="p">:(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>

<span class="c"># use the following libx264 compression options</span>
<span class="n">lib_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;preset&#39;</span><span class="p">:</span><span class="s">&#39;slow&#39;</span><span class="p">,</span> <span class="s">&#39;crf&#39;</span><span class="p">:</span><span class="s">&#39;22&#39;</span><span class="p">}</span>
<span class="c"># set the following metadata (ffmpeg doesn&#39;t always support writing metadata)</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;title&#39;</span><span class="p">:</span><span class="s">&#39;Singing in the sun&#39;</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">:</span><span class="s">&#39;Rat&#39;</span><span class="p">,</span> <span class="s">&#39;genre&#39;</span><span class="p">:</span><span class="s">&#39;Animal sounds&#39;</span><span class="p">}</span>

<span class="c"># write using yuv420p frames into a two stream h264 codec, mp4 file where the output</span>
<span class="c"># is half the input size for both streams.</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">MediaWriter</span><span class="p">(</span><span class="s">&#39;output.avi&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">out_opts</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;mp4&#39;</span><span class="p">,</span>
                     <span class="n">width_out</span><span class="o">=</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height_out</span><span class="o">=</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">pix_fmt_out</span><span class="o">=</span><span class="s">&#39;yuv420p&#39;</span><span class="p">,</span>
                     <span class="n">lib_opts</span><span class="o">=</span><span class="n">lib_opts</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

<span class="c"># Construct images</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">buf</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">255</span> <span class="o">/</span> <span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
<span class="n">buf</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span> <span class="n">buf</span><span class="p">))</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">plane_buffers</span><span class="o">=</span><span class="p">[</span><span class="n">buf</span><span class="p">],</span> <span class="n">pix_fmt</span><span class="o">=</span><span class="s">&#39;rgb24&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

<span class="n">buf</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">size</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span> <span class="o">/</span> <span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
<span class="n">buf</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span> <span class="n">buf</span><span class="p">))</span>
<span class="n">img2</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">plane_buffers</span><span class="o">=</span><span class="p">[</span><span class="n">buf</span><span class="p">],</span> <span class="n">pix_fmt</span><span class="o">=</span><span class="s">&#39;rgb24&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">write_frame</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="n">i</span> <span class="o">/</span> <span class="mf">5.</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c"># stream 1</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">write_frame</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">img2</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="n">i</span> <span class="o">/</span> <span class="mf">5.</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># stream 2</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The file is is not fully written until the MediaWriter instance is deleted
because data is cached while writing. The encoders are only flushed when
the instance is deleted.</p>
</div>
<dl class="method">
<dt id="ffpyplayer.writer.MediaWriter.get_configuration">
<tt class="descname">get_configuration</tt><big>(</big><em>self</em><big>)</big><a class="headerlink" href="#ffpyplayer.writer.MediaWriter.get_configuration" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the configuration parameters used to initialize all the streams
in the writer.</p>
<dl class="docutils">
<dt><strong>Returns</strong>:</dt>
<dd>(list): List of dicts for each stream.</dd>
</dl>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ffpyplayer.writer</span> <span class="kn">import</span> <span class="n">MediaWriter</span>

<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span>
<span class="n">out_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;pix_fmt_in&#39;</span><span class="p">:</span><span class="s">&#39;rgb24&#39;</span><span class="p">,</span> <span class="s">&#39;width_in&#39;</span><span class="p">:</span><span class="n">w</span><span class="p">,</span> <span class="s">&#39;height_in&#39;</span><span class="p">:</span><span class="n">h</span><span class="p">,</span> <span class="s">&#39;codec&#39;</span><span class="p">:</span><span class="s">&#39;rawvideo&#39;</span><span class="p">,</span>
            <span class="s">&#39;frame_rate&#39;</span><span class="p">:(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">MediaWriter</span><span class="p">(</span><span class="s">&#39;output.avi&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">out_opts</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_out</span><span class="o">=</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height_out</span><span class="o">=</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span> <span class="n">writer</span><span class="o">.</span><span class="n">get_configuration</span><span class="p">()</span>
<span class="p">[{</span><span class="s">&#39;height_in&#39;</span><span class="p">:</span> <span class="mi">480</span><span class="p">,</span> <span class="s">&#39;codec&#39;</span><span class="p">:</span> <span class="s">&#39;rawvideo&#39;</span><span class="p">,</span> <span class="s">&#39;width_in&#39;</span><span class="p">:</span> <span class="mi">640</span><span class="p">,</span> <span class="s">&#39;frame_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="s">&#39;pix_fmt_in&#39;</span><span class="p">:</span> <span class="s">&#39;rgb24&#39;</span><span class="p">,</span> <span class="s">&#39;width_out&#39;</span><span class="p">:</span> <span class="mi">320</span><span class="p">,</span> <span class="s">&#39;height_out&#39;</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span> <span class="s">&#39;pix_fmt_out&#39;</span><span class="p">:</span> <span class="s">&#39;rgb24&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s">&#39;height_in&#39;</span><span class="p">:</span> <span class="mi">480</span><span class="p">,</span> <span class="s">&#39;codec&#39;</span><span class="p">:</span> <span class="s">&#39;rawvideo&#39;</span><span class="p">,</span> <span class="s">&#39;width_in&#39;</span><span class="p">:</span> <span class="mi">640</span><span class="p">,</span> <span class="s">&#39;frame_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="s">&#39;pix_fmt_in&#39;</span><span class="p">:</span> <span class="s">&#39;rgb24&#39;</span><span class="p">,</span> <span class="s">&#39;width_out&#39;</span><span class="p">:</span> <span class="mi">320</span><span class="p">,</span> <span class="s">&#39;height_out&#39;</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span> <span class="s">&#39;pix_fmt_out&#39;</span><span class="p">:</span> <span class="s">&#39;rgb24&#39;</span><span class="p">}]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ffpyplayer.writer.MediaWriter.write_frame">
<tt class="descname">write_frame</tt><big>(</big><em>self</em>, <em>Image img</em>, <em>double pts</em>, <em>int stream</em><big>)</big><a class="headerlink" href="#ffpyplayer.writer.MediaWriter.write_frame" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes a <a class="reference internal" href="pic.html#ffpyplayer.pic.Image" title="ffpyplayer.pic.Image"><tt class="xref py py-class docutils literal"><span class="pre">ffpyplayer.pic.Image</span></tt></a> frame to the specified stream.</p>
<p>If the input data is different than the frame written to disk in either
size or pixel format as specified when creating the writer, the frame
is converted before writing. But the input image must match the size and
format to that specified when creating the writer.</p>
<dl class="docutils">
<dt><strong>Args</strong>:</dt>
<dd><p class="first"><em>img</em> (<a class="reference internal" href="pic.html#ffpyplayer.pic.Image" title="ffpyplayer.pic.Image"><tt class="xref py py-class docutils literal"><span class="pre">ffpyplayer.pic.Image</span></tt></a>): The <a class="reference internal" href="pic.html#ffpyplayer.pic.Image" title="ffpyplayer.pic.Image"><tt class="xref py py-class docutils literal"><span class="pre">ffpyplayer.pic.Image</span></tt></a>
instance containing the frame to be written to disk.</p>
<p><em>pts</em> (float): The timestamp of this frame in video time. E.g. 0.5
means the frame should be displayed by a player at 0.5 seconds after
the video started playing. In a sense, the frame rate defines which
timestamps are valid timestamps. However, this is not always the
case, so if timestamps are invalid for a particular format, they are
forced to valid values, if possible.</p>
<p class="last"><em>stream</em> (int): The stream number to which to write this frame.</p>
</dd>
<dt><strong>Returns</strong>:</dt>
<dd><p class="first">(int): The approximate number of bytes written to disk so far for
this file.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p>This is not the same as the number of bytes passed to this function
so far, because the encoders cache data before writing to disk.
So although some frames may have been passed, the return value
may not represent this.</p>
<p class="last">An extereme example is where the same frame is passed many times
to h264; the encoder will only write this frame when the Writer
object is deleted and encoders are flushed, so this function
will only return 0.</p>
</div>
</dd>
</dl>
<p>See <a class="reference internal" href="examples.html#examples"><em>Examples</em></a> for its usage.</p>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tools.html" title="FFmpeg tools"
             >previous</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>

          <li><a href="api.html" >The FFPyPlayer API</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Matthew Einhorn.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>